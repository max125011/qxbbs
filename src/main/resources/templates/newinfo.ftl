<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <#--<title>-->
    <#--<#if article ?exists && article.title ?exists>${article.title}</#if>-->
    <#--</title>-->
    <title>info页</title>
    <link href="${context.contextPath}/css/bootstrap.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="${context.contextPath}/js/html5shiv.js"></script>
    <script src="${context.contextPath}/js/respond.min.js"></script>
    <![endif]-->

    <script type='text/javascript' src='${context.contextPath}/js/jquery.1.9.js'></script>
    <script type='text/javascript' src='${context.contextPath}/js/bootstrap.min.js'></script>
    <script type="text/javascript" src="${context.contextPath}/js/ueditor/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <script type="text/javascript" src="${context.contextPath}/js/ueditor/ueditor.all.js"></script>
    <script type="text/javascript">


    </script>
</head>
<body style="background-color:" >
    <!--顶部logo-->
    <div style="width: 100%">
        <div style="display: inline;padding-left: 5px;">
            <a><img style="width: 100%;height: 140px;" src="${context.contextPath}/images/logo/banner.jpg"/></a>
        </div>
    </div>
    <!--头部-->
    <div style="width: 100%;">
        <div>
            <#--<div style="display: inline;padding-left: 5px;">-->
                <#--<a style="margin: 0;width: 150px !important;height: 50px !important;" href=""><img src="${context.contextPath}/images/logo/qx-logo.png"/></a>-->
            <#--</div>-->
            <div style="display: inline;padding-top:20px;padding-left:840px;float: right">
                <a style="text-decoration:none;" href="" ><img src="${context.contextPath}/images/user/${user.pictureUrl}" width="32px" height="32px">&nbsp;&nbsp;&nbsp;${user.nickname}</a>
            </div>
        </div>
    </div>

    <div id="primary" class="content-area" style="padding-top:80px;margin: auto;max-width:890px;margin: 0 auto;">
                <div class="article-content">
                    <div>
                        <h1 style="text-align: center">虞美人</h1>
                        <div style="text-align: center;padding-top: 10px;color: #00a2d4;">
                            <span class="posted-on"><time class="entry-date published" datetime="">发表时间：2014-12-11</time></span>
                        </div>
                    </div>
                    <p class="p1" style="text-align: center;padding-top: 30px;"><strong><span class="s1">| 作者：花满楼|</span></strong></p>
                    <p class="p1" style="text-align: center;"><span id="more-340"></span></p>
                    <hr/>
                    <!--文章内容-->
                    <div>
                        <p>哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或
                            哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或
                            哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或
                            哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或
                            哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或
                            哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或哈哈哈哈哈哈或或或或或或或或或
                        </p>
                    </div><hr/>

                    <div style="text-align: center">
                        <img src="${context.contextPath}/images/no-content.jpg" width="640" height="379" align="center">
                    </div>
                        <br/>
                        <p class="p1" style="text-align: center;"><span class="s1">这家伙很懒，没有留下帖子的内容。。。</span></p>
                    <hr/>
                </div>
                <!--领导批示区-->
                <div style="max-width: 750px;margin: 0 auto;">
                    <p style="color: red;font-size: x-large;text-align: center">领导批示</p>
                    <p>在欧阳修的一再称赞下，苏轼一时声名大噪。他每有新作，立刻就会传遍京师。当父子名动京师、正要大展身手时，突然传来苏轼苏辙的母亲病故的噩耗。二兄弟随父回乡奔丧。嘉祐四年十月守丧期满回京，嘉祐六年（1061年），苏轼应中制科考试，即通常所谓的“三年京察”，入第三等，为“百年第一”，授大理评事、签书凤翔府判官。[15]  四年后还朝判登闻鼓院。治平二年，苏洵病逝，苏轼、苏辙兄弟扶柩还乡，守孝三年。三年之后，苏轼还朝，震动朝野的王安石变法开始了。苏轼的许多师友，包括当初赏识他的恩师欧阳修在内，因反对新法与新任宰相王安石政见不合，被迫离京。朝野旧雨凋零，苏轼眼中所见，已不是他二十岁时所见的“平和世界”。</p>
                </div><br/><hr>
                <!--评论编辑区-->
                <div class="article-comment" style="padding-left: 70px;">
                    <div id="comment_editor" class="comment_editor">
                        <script id="container" name="content" type="text/plain">
                        </script>
                        <p style="text-align:right;padding-top: 10px;padding-right: 70px"><button type="button" class="btn btn-info" id="comment-submit" onclick="submit();">提交评论</button></p>
                            <#--<p style="text-align:right;padding-top: 10px;padding-right: 10px"><a href="javascript:void (0)" type="button" class="btn btn-primary" onclick="submit();">提交评论</a></p>-->
                    </div>
                </div>
                <#--<hr>-->

                <!-- 底部评论区 -->
                <div class="comment_bottom" style="padding-left: 20px;">
                        <h2>1个评论</h2>
                </div>
                <hr/>
                <!--评论内容-->
                <div id="comment-content" style="padding-left:20px;width: 830px;">
                    <p>
                        <a style="text-decoration:none;" href="" ><img src="${context.contextPath}/images/user/default-1.jpg" width="32px" height="32px">&nbsp;&nbsp;&nbsp;滴水沧海</a></a><br/>
                        哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈 哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈 哈哈哈哈哈哈哈<hr/>
                    </p>
                    <p>
                        <a style="text-decoration:none;" href="" ><img src="${context.contextPath}/images/user/default-1.jpg" width="32px" height="32px">&nbsp;&nbsp;&nbsp;滴水沧海</a><br/>
                        哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈 哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈 哈哈哈哈哈哈哈<hr/>
                    </p>
                    <p>
                        <a style="text-decoration:none;" href="" ><img src="${context.contextPath}/images/user/default-1.jpg" width="32px" height="32px">&nbsp;&nbsp;&nbsp;滴水沧海</a></a><br/>
                        哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈 哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈 哈哈哈哈哈哈哈<hr/>
                    </p>
                </div>
                <!--评论分页-->
                <div id="comment-page" align="right"; style="padding-right: 60px;padding-bottom: 90px;">
                    <nav aria-label="Page navigation" align="right">
                        <ul class="pagination">
                            <li><a href="#" aria-label="Previous"><span aria-hidden="true">上一页</span></a></li>
                            <li class="active"><a>1/3</a></li>
                            <li><a href="#" aria-label="Next"><span aria-hidden="true">下一页</span></a></li>
                        </ul>
                    </nav>
                </div>
    </div>




        <!-- 模态框（Modal）开始 -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
            <div class="modal-dialog" >
                <div class="modal-content" style="background-color:#d0e4fe;">
                    <div class="modal-body" style="text-align: center;">
                        <h5 id="submit">提交成功，请等待管理员审核！</h5>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info btn-lg"
                                data-dismiss="modal">确认
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <!-- 模态框（Modal）结束 -->

        <!--底部-->
        <div>
            <div style="width: 100%; background-color: #080808;height: 70px;position:static;">
                <div class="text" style="padding-top: 20px;">
                    <div style="text-align: center;font-size: larger;color: white;">Copyright © 2017 栖霞区公安分局</div>
                </div>
            </div>
        </div>
</body>

<script type="text/javascript">

    function commentInit(id, page) {

        var commentlist = '';
        var paging = '';
        if (page < 1){
            page = 1;
        }
        //请求评论信息
        $.ajax({
            url: "${context.contextPath}/comment/list?id=" + id + "&page=" + page,
            type: "GET",
            success: function (data) {
                if (data != null) {
                    if (data.list != null && data.list.length > 0){
                        for (var i = 0; i < data.list.length; i++){
                            var comment = data.list[i];
                            commentlist = commentlist + appendCommentHTML(comment);
                        }
                        paging = commentPageing(data.pageInfo);
                        $("#comment-content").html(commentlist);
                        $("#comment-page").html(paging);
                    }else {
                        commentlist = '<div style="text-align:center"><Strong>智慧如你，不想发表一点想法咩~~~</Strong></div>';
                        $("#comment-content").html(commentlist);
                    }
                }
            }
        });
    }
    //分页
    function commentPageing(pageInfo) {
        var html = '';
        var pre = pageInfo.prePage;
        var current = pageInfo.pageCurrent;
        var next = pageInfo.nextPage;
        var pages = pageInfo.pages;

        if (pageInfo != null){
            html = '<nav aria-label="Page navigation" ><ul class="pagination"><li><a href="javascript:void(0)" onclick="commentInit(<#if article?exists>${article.id ?c}</#if>,' + pre + ');" aria-label="Previous"><span aria-hidden="true">上一页</span></a></li>'
                    + '<li><a>' + current + '/' + pages + '</a></li>'
                    + '<li><a href="javascript:void(0)" onclick="commentInit(<#if article?exists>${article.id ?c}</#if>,' + next + ');" aria-label="Next"><span aria-hidden="true">下一页</span></a></li></ul></nav>	';
        }
        return html;
    }

    //拼装comment信息（HTML）
    function appendCommentHTML(comment) {
        var html = '';
        if (comment != null){
            var picture = comment.pictureUrl;
            if (picture == null)
                picture = 'default-1.jpg';
            html = '<div class="aw-item" id="answer_list"><div class="mod-head"><a class="anchor"></a>'
                    + '<a class="aw-user-img aw-border-radius-5 pull-right"><img src="${context.contextPath}/images/user/'
                    + picture + '"/></a><div class="title"><p><a class="aw-user-name">' + comment.nickname
                    + '</a></p></div></div><div class="mod-body clearfix"><div class="markitup-box">' + comment.content
                    + '</div></div><div class="mod-footer"><div class="meta clearfix"><span class="text-color-999 pull-right">'
                    + '2017-04-06</span></div></div></div>';
        }
        return html;
    }
</script>

<#--评论框JS-->
<script type="text/javascript">

    //UEditor配置
    var ue = UE.getEditor( 'container', {
        autoHeightEnabled: true,
        autoFloatEnabled: true,
        initialFrameWidth: 750,
        initialFrameHeight:150,
        toolbars:[['emotion']]
    });

    function submit(articleId, userId){
//        $("#comment-submit").attr("disabled", "true");
        var comment_content;//评论内容，经过编辑过的
        var commnet_txt;//评论内容，存文本
        ue.ready(function() {
            //设置编辑器的内容
            comment_content = ue.getContent();
            commnet_txt = ue.getContentTxt();
        });
        // url需要改成评论的url，后台提供
        //需要传给后台的参数有（评论内容,评论人Id,评论时间）
        var param = {
            'articleId': articleId,
            'userId': userId,
            'content': comment_content
        };

        var url = "${context.contextPath}/comment/insert"
        $.ajax({
            url: url,
            type: "POST",
            data: param,
            success: function (data) {
                if (data == 1) {
                    $('#myModal').modal({
                        keyboard: true
                    });
                    ue.setContent('');
                }else {
                    $("#submit").text("提交评论失败，请重试！")
                    $('#myModal').modal({
                        keyboard: true
                    });
                }
                $("#comment-submit").attr("disabled", "false");
            },
            error:function(){
                $("#submit").text("提交评论失败，请重试！");
                $('#myModal').modal({
                    keyboard: true
                });
                $("#comment-submit").attr("disabled", "false");
            }
        });
        $("#comment-submit").attr("disabled", "true");

    }
</script>
</html>
